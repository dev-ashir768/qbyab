# ===============================================
# 1. URL Rewrite Rules (Remove .html Extension)
# ===============================================

# Turn on the Rewrite Engine
RewriteEngine On
RewriteBase /

# 1. Check if the requested URI is not an existing directory
RewriteCond %{REQUEST_FILENAME} !-d
# 2. Check if the requested URI is not an existing file (e.g., image.png)
RewriteCond %{REQUEST_FILENAME} !-f

# If both conditions pass, append .html to the request and process it.
# This makes URLs like /about work by loading /about.html
# [NC] = No Case (case-insensitive), [L] = Last Rule (stop processing rules)
RewriteRule ^([^/.]+)$ $1.html [NC,L]


# ===============================================
# 2. Browser Caching (Cache-Control & Expires Headers)
# ===============================================

# 2.1. Use Expires Headers (older method, good fallback)
<IfModule mod_expires.c>
  ExpiresActive On
  
  # Default setting for all files: 1 hour
  ExpiresDefault "access plus 1 hour" 

  # HTML Files: Force re-validation frequently (Important for fast CI/CD updates)
  ExpiresByType text/html "access plus 0 seconds" 
  
  # CSS and JavaScript: Cache for 1 month
  ExpiresByType text/css "access plus 1 month"
  ExpiresByType application/javascript "access plus 1 month"
  
  # Images: Cache for 1 year (Best for performance)
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/webp "access plus 1 year"
  ExpiresByType image/x-icon "access plus 1 year" # Favicons
  ExpiresByType application/vnd.ms-fontobject "access plus 1 year"
  ExpiresByType application/x-font-woff "access plus 1 year"
  ExpiresByType font/ttf "access plus 1 year"
  ExpiresByType font/otf "access plus 1 year"
  ExpiresByType application/x-font-woff2 "access plus 1 year"

</IfModule>


# 2.2. Use Cache-Control Headers (modern control)
<IfModule mod_headers.c>

  # HTML Files: Must-revalidate on every push/visit
  # This ensures users see new deployments quickly
  <FilesMatch "\.(html|htm)$">
    Header set Cache-Control "max-age=0, public, must-revalidate"
  </FilesMatch>

  # CSS, JS, Images: Aggressive caching (30 days)
  # Use versioning (e.g., style.css?v=1.1) in HTML to bypass this cache when files change
  <FilesMatch "\.(css|js|jpe?g|png|gif|webp|svg|ico|pdf|eot|woff|ttf)$">
    Header set Cache-Control "max-age=2592000, public"
  </FilesMatch>
  
</IfModule>

# ===============================================
# 3. Security Headers (Optional but Recommended)
# ===============================================

# Prevent framing of the site (Clickjacking prevention)
Header always append X-Frame-Options SAMEORIGIN

# Enable XSS filtering
Header always append X-XSS-Protection "1; mode=block"

# Force connections to be secure (if you have SSL/HTTPS)
# Remove this line if you do not have SSL/HTTPS enabled
# Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"

# Deny content sniffing (Improves security)
Header always set X-Content-Type-Options nosniff